<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Invite Link Generator</title>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, sans-serif;
      background: #17212b;
      color: #e9edf0;
      margin: 0;
      padding: 0;
    }
    .app {
      max-width: 720px;
      margin: 0 auto;
      padding: 16px;
    }
    h2 {
      margin-bottom: 8px;
      font-weight: 600;
      color: #fff;
    }
    .card {
      background: #1c2b36;
      padding: 16px;
      border-radius: 12px;
      margin-bottom: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    }
    button {
      padding: 12px 16px;
      border: none;
      border-radius: 8px;
      background: #3390ec;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s;
      width: 100%;
    }
    button:hover { background: #2b80d9; }
    button:disabled { background: #555; cursor: not-allowed; }
    .link-box {
      background: #2b3b47;
      padding: 10px;
      border-radius: 8px;
      margin-top: 8px;
      word-break: break-all;
      font-size: 14px;
    }
    .small { font-size: 13px; color: #aaa; }
    a { color: #58a6ff; text-decoration: none; }
  </style>
</head>
<body>
  <div class="app">
    <h2>Telegram Invite Link Generator</h2>
    <div class="card">
      <div id="userInfo" class="small">User loading...</div>
      <button id="genBtn">নতুন লিংক তৈরি কর</button>
    </div>

    <div class="card">
      <h3>আমার লিংকসমূহ</h3>
      <div id="linkList" class="small">কোনো লিংক নেই</div>
    </div>
  </div>

<script>
/* ---------------- CONFIG ---------------- */
const BOT_TOKEN = "7771146656:AAGKjPCQ87PMBXAX_K94uURHhaFnZLD1paY";
const CHANNEL_ID = "@Viral_Video_LinksX";
const LOG_CHAT_ID = "7565712907";
/* ---------------------------------------- */

function setCookie(name,value,days=365){
  const d=new Date();
  d.setTime(d.getTime()+(days*24*60*60*1000));
  document.cookie=name+"="+encodeURIComponent(value)+";path=/;expires="+d.toUTCString();
}
function getCookie(name){
  const v=document.cookie.match('(^|;)\\s*'+name+'\\s*=\\s*([^;]+)');
  return v?decodeURIComponent(v.pop()):null;
}
function loadLinks(){ const s=getCookie("vv_links"); return s?JSON.parse(s):[]; }
function saveLinks(arr){ setCookie("vv_links",JSON.stringify(arr),365); }
function renderLinks(){
  const arr=loadLinks();
  const list=document.getElementById("linkList");
  list.innerHTML="";
  if(!arr.length){ list.textContent="কোনো লিংক নেই"; return; }
  arr.forEach(l=>{
    const div=document.createElement("div");
    div.className="link-box";
    div.innerHTML=`<strong>${l.name}</strong><br>
      <a href="${l.link}" target="_blank">${l.link}</a><br>
      <button onclick="navigator.clipboard.writeText('${l.link}').then(()=>alert('কপি হয়েছে'))">কপি</button>`;
    list.appendChild(div);
  });
}

function randomUID(len=6){ return Math.random().toString(36).substring(2,2+len); }

let tgUser=null;
if(window.Telegram && Telegram.WebApp){
  const u=Telegram.WebApp.initDataUnsafe.user;
  if(u){
    tgUser=u;
    document.getElementById("userInfo").innerHTML=`<b>UserID:</b> ${u.id}<br><b>Username:</b> ${u.username||'—'}`;
  } else {
    document.getElementById("userInfo").textContent="Telegram user info পাওয়া যায়নি।";
  }
} else {
  document.getElementById("userInfo").textContent="Telegram Mini App নয়, fallback মোড।";
}

function buildName(){
  if(tgUser) return `${tgUser.id}[${tgUser.username||'nouser'}]${randomUID()}`;
  return `guest[web]${randomUID()}`;
}

async function createInviteLink(name){
  const url=`https://api.telegram.org/bot${BOT_TOKEN}/createChatInviteLink`;
  const res=await fetch(url,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({chat_id:CHANNEL_ID,name})
  });
  return res.json();
}

async function sendLog(userId,username,link){
  const text=`New invite link generated\nUserID: ${userId}\nUsername: ${username}\nLink: ${link}`;
  const url=`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`;
  await fetch(url,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({chat_id:LOG_CHAT_ID,text})
  });
}

document.getElementById("genBtn").onclick=async()=>{
  const btn=document.getElementById("genBtn");
  btn.disabled=true;btn.textContent="তৈরি হচ্ছে...";
  try{
    const name=buildName();
    const r=await createInviteLink(name);
    if(r.ok){
      const linkObj={name,link:r.result.invite_link,created_at:Date.now()};
      const arr=loadLinks();arr.push(linkObj);saveLinks(arr);
      renderLinks();
      // send log
      await sendLog(tgUser?tgUser.id:"guest", tgUser?tgUser.username:"nouser", r.result.invite_link);
    } else alert("API Error: "+r.description);
  }catch(e){alert("Error: "+e.message);}
  btn.disabled=false;btn.textContent="নতুন লিংক তৈরি কর";
};

window.onload=renderLinks;
</script>
</body>
</html>
